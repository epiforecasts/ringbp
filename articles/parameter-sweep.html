<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Scenario parameter sweep • ringbp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Scenario parameter sweep">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ringbp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2.9999</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/parameter-sweep.html">Scenario parameter sweep</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/ringbp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Scenario parameter sweep</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/ringbp/blob/main/vignettes/parameter-sweep.Rmd" class="external-link"><code>vignettes/parameter-sweep.Rmd</code></a></small>
      <div class="d-none name"><code>parameter-sweep.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates how to run an analysis using the {ringbp}
simulation across multiple scenarios.</p>
<div class="alert alert-info">
<p>The functionality included in this vignette was previously in the
<code>parameter_sweep()</code> function in {ringbp} &lt;= v0.1.2. This
function has been removed as it is preferred to demonstrate the
functionality but allow users the flexibility and control to run
scenarios in whichever way they choose.</p>
</div>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://epiforecasts.io/ringbp">ringbp</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/scenario_sim.html">scenario_sim()</a></code> function is the core function to run
outbreak simulations using {ringbp}, because it allows running the
<code><a href="../reference/outbreak_model.html">outbreak_model()</a></code> over multiple replicates.</p>
<div class="section level2">
<h2 id="set-up-scenario-parameter-space">Set up scenario parameter space<a class="anchor" aria-label="anchor" href="#set-up-scenario-parameter-space"></a>
</h2>
<p>The first step to construct a <code>data.frame</code> (in this
example we will use a <code>data.table</code>) with a grid of
parameters, i.e. a parameter space to explore. We use
<code><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid()</a></code> to create all the combinations of
parameters.</p>
<p>Parameters that are grouped are put into a nested
<code>data.table</code> to make sure they are coupled and combinations
of these parameters are not mixed. See <code>delay_group</code> below
for an example of this.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Put parameters that are grouped by disease into this data.table</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>   delay_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>     delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SARS"</span>, <span class="st">"Wuhan"</span><span class="op">)</span>,</span>
<span>     onset_to_isolation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>       \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, shape <span class="op">=</span> <span class="fl">1.651524</span>, scale <span class="op">=</span> <span class="fl">4.287786</span><span class="op">)</span>,</span>
<span>       \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, shape <span class="op">=</span> <span class="fl">2.305172</span>, scale <span class="op">=</span> <span class="fl">9.483875</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span>
<span>   <span class="op">)</span><span class="op">)</span>,</span>
<span>   r0_community <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.5</span><span class="op">)</span>,</span>
<span>   r0_isolated <span class="op">=</span> <span class="fl">0</span>,</span>
<span>   disp_community <span class="op">=</span> <span class="fl">0.16</span>,</span>
<span>   disp_isolated <span class="op">=</span> <span class="fl">1</span>,</span>
<span>   prop_presymptomatic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.15</span><span class="op">)</span>,</span>
<span>   prop_asymptomatic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>   prop_ascertain <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>   initial_cases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>   quarantine <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>   cap_max_days <span class="op">=</span> <span class="fl">365</span>,</span>
<span>   cap_cases <span class="op">=</span> <span class="fl">5000</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To unnest the <code>data.table</code> in order to sweep across the
scenarios, a few data manipulation steps are required:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">list_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_group"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">non_list_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">scenarios</span><span class="op">)</span>, <span class="va">list_cols</span><span class="op">)</span></span>
<span><span class="va">scenarios</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span>, <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="va">delay_group</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">non_list_cols</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Lastly in setting up the parameter grid we add a column called
<code>scenario</code> which is numbered 1 to the total number of
scenarios; and we add the incubation period to the parameter grid.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenarios</span><span class="op">[</span>, <span class="va">scenario</span> <span class="op">:=</span>  <span class="fl">1</span><span class="op">:</span><span class="va">.N</span><span class="op">]</span></span>
<span><span class="va">incub</span> <span class="op">&lt;-</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, shape <span class="op">=</span> <span class="fl">1.65</span>, scale <span class="op">=</span> <span class="fl">4.28</span><span class="op">)</span></span>
<span><span class="va">scenarios</span><span class="op">[</span>, <span class="va">incubation_period</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">incub</span><span class="op">)</span>, <span class="va">.N</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="parameter-sweep-across-scenarios">Parameter sweep across scenarios<a class="anchor" aria-label="anchor" href="#parameter-sweep-across-scenarios"></a>
</h2>
<p>Before we run <code><a href="../reference/scenario_sim.html">scenario_sim()</a></code> across each parameter set,
we split the scenarios into a list. This makes it easy to loop over the
resulting list using R functions like <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenario_sims</span> <span class="op">&lt;-</span> <span class="va">scenarios</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">scenario</span><span class="op">]</span></span></code></pre></div>
<p>For this example we will run 3 replicates for each parameter set. The
simulation model is stochastic so by running multiple replicates for
each, we can understand the variance within scenarios. For a
scientifically robust analysis, the number of replicates should be much
higher (e.g. 100-1000).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">scenario_sims</span><span class="op">$</span><span class="va">data</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/scenario_sim.html">scenario_sim</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    initial_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">initial_cases</span>,</span>
<span>    offspring <span class="op">=</span> <span class="fu"><a href="../reference/offspring_opts.html">offspring_opts</a></span><span class="op">(</span></span>
<span>      community <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_community</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_community</span><span class="op">)</span>,</span>
<span>      isolated <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_isolated</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_isolated</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span></span>
<span>      incubation_period <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">incubation_period</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      onset_to_isolation <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">onset_to_isolation</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    event_probs <span class="op">=</span> <span class="fu"><a href="../reference/event_prob_opts.html">event_prob_opts</a></span><span class="op">(</span></span>
<span>      asymptomatic <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_asymptomatic</span>,</span>
<span>      presymptomatic_transmission <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_presymptomatic</span>,</span>
<span>      symptomatic_ascertained <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_ascertain</span></span>
<span>    <span class="op">)</span>,</span>
<span>    interventions <span class="op">=</span> <span class="fu"><a href="../reference/intervention_opts.html">intervention_opts</a></span><span class="op">(</span>quarantine <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">quarantine</span><span class="op">)</span>,</span>
<span>    sim <span class="op">=</span> <span class="fu"><a href="../reference/sim_opts.html">sim_opts</a></span><span class="op">(</span>cap_max_days <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_max_days</span>, cap_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_cases</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  n <span class="op">=</span> <span class="va">n</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output of this parameter sweep is a list of
<code>data.table</code>s, so to give an idea of what the output looks
like we show the first 3 scenarios (there are 160 in total). See
<code><a href="../reference/scenario_sim.html">?scenario_sim</a></code> for more information on the contents of these
<code>data.table</code>s.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0         cases_per_gen</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;                &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0            6          6     0.200000                   2,0</span></span>
<span><span class="co">#&gt;   2:     1     1            1          7     0.200000                   2,0</span></span>
<span><span class="co">#&gt;   3:     1     2            0          7     0.200000                   2,0</span></span>
<span><span class="co">#&gt;   4:     1     3            0          7     0.200000                   2,0</span></span>
<span><span class="co">#&gt;   5:     1     4            0          7     0.200000                   2,0</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 155:     3    48            0         91     1.032414  8,20,20,19, 5, 4,...</span></span>
<span><span class="co">#&gt; 156:     3    49            0         91     1.032414  8,20,20,19, 5, 4,...</span></span>
<span><span class="co">#&gt; 157:     3    50            0         91     1.032414  8,20,20,19, 5, 4,...</span></span>
<span><span class="co">#&gt; 158:     3    51            0         91     1.032414  8,20,20,19, 5, 4,...</span></span>
<span><span class="co">#&gt; 159:     3    52            0         91     1.032414  8,20,20,19, 5, 4,...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0         cases_per_gen</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;                &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0           10         10     1.290414  8,19, 2, 9, 3, 5,...</span></span>
<span><span class="co">#&gt;   2:     1     1           14         24     1.290414  8,19, 2, 9, 3, 5,...</span></span>
<span><span class="co">#&gt;   3:     1     2           12         36     1.290414  8,19, 2, 9, 3, 5,...</span></span>
<span><span class="co">#&gt;   4:     1     3            9         45     1.290414  8,19, 2, 9, 3, 5,...</span></span>
<span><span class="co">#&gt;   5:     1     4           14         59     1.290414  8,19, 2, 9, 3, 5,...</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 155:     3    48            0          5     0.000000                     0</span></span>
<span><span class="co">#&gt; 156:     3    49            0          5     0.000000                     0</span></span>
<span><span class="co">#&gt; 157:     3    50            0          5     0.000000                     0</span></span>
<span><span class="co">#&gt; 158:     3    51            0          5     0.000000                     0</span></span>
<span><span class="co">#&gt; 159:     3    52            0          5     0.000000                     0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0            5          5     0.000000</span></span>
<span><span class="co">#&gt;   2:     1     1            0          5     0.000000</span></span>
<span><span class="co">#&gt;   3:     1     2            0          5     0.000000</span></span>
<span><span class="co">#&gt;   4:     1     3            0          5     0.000000</span></span>
<span><span class="co">#&gt;   5:     1     4            0          5     0.000000</span></span>
<span><span class="co">#&gt;  ---                                                 </span></span>
<span><span class="co">#&gt; 155:     3    48            0       6373     1.836735</span></span>
<span><span class="co">#&gt; 156:     3    49            0       6373     1.836735</span></span>
<span><span class="co">#&gt; 157:     3    50            0       6373     1.836735</span></span>
<span><span class="co">#&gt; 158:     3    51            0       6373     1.836735</span></span>
<span><span class="co">#&gt; 159:     3    52            0       6373     1.836735</span></span>
<span><span class="co">#&gt;                    cases_per_gen</span></span>
<span><span class="co">#&gt;                           &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:                           0</span></span>
<span><span class="co">#&gt;   2:                           0</span></span>
<span><span class="co">#&gt;   3:                           0</span></span>
<span><span class="co">#&gt;   4:                           0</span></span>
<span><span class="co">#&gt;   5:                           0</span></span>
<span><span class="co">#&gt;  ---                            </span></span>
<span><span class="co">#&gt; 155:  13, 55, 96,181,211,339,...</span></span>
<span><span class="co">#&gt; 156:  13, 55, 96,181,211,339,...</span></span>
<span><span class="co">#&gt; 157:  13, 55, 96,181,211,339,...</span></span>
<span><span class="co">#&gt; 158:  13, 55, 96,181,211,339,...</span></span>
<span><span class="co">#&gt; 159:  13, 55, 96,181,211,339,...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="storing-simulations-with-scenarios">Storing simulations with scenarios<a class="anchor" aria-label="anchor" href="#storing-simulations-with-scenarios"></a>
</h2>
<p>In the previous example we constructed the parameter grid and then
ran the parameter sweep storing the simulated outbreaks in a separate
object. It can be useful to keep the simulated output together with the
parameter grid to be able to check which parameters correspond to which
simulated outbreak.</p>
<p>In this example we run the same scenario parameter sweep as before
(again with 3 replicates), but store the simulated outbreak
<code>data.table</code>s in the same object as the list of scenarios. We
append the simulation results to the <code>scenario_sims</code>
<code>data.table</code> and assign them to the <code>sims</code>
column.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenario_sims</span><span class="op">[</span>, <span class="va">sims</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/scenario_sim.html">scenario_sim</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    initial_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">initial_cases</span>,</span>
<span>    offspring <span class="op">=</span> <span class="fu"><a href="../reference/offspring_opts.html">offspring_opts</a></span><span class="op">(</span></span>
<span>      community <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_community</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_community</span><span class="op">)</span>,</span>
<span>      isolated <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_isolated</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_isolated</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span></span>
<span>      incubation_period <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">incubation_period</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      onset_to_isolation <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">onset_to_isolation</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    event_probs <span class="op">=</span> <span class="fu"><a href="../reference/event_prob_opts.html">event_prob_opts</a></span><span class="op">(</span></span>
<span>      asymptomatic <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_asymptomatic</span>,</span>
<span>      presymptomatic_transmission <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_presymptomatic</span>,</span>
<span>      symptomatic_ascertained <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_ascertain</span></span>
<span>    <span class="op">)</span>,</span>
<span>    interventions <span class="op">=</span> <span class="fu"><a href="../reference/intervention_opts.html">intervention_opts</a></span><span class="op">(</span>quarantine <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">quarantine</span><span class="op">)</span>,</span>
<span>    sim <span class="op">=</span> <span class="fu"><a href="../reference/sim_opts.html">sim_opts</a></span><span class="op">(</span>cap_max_days <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_max_days</span>, cap_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_cases</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  n <span class="op">=</span> <span class="va">n</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scenario_sims</span></span>
<span><span class="co">#&gt;      scenario               data                sims</span></span>
<span><span class="co">#&gt;         &lt;int&gt;             &lt;list&gt;              &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:        1 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt;   2:        2 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt;   3:        3 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt;   4:        4 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt;   5:        5 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt;  ---                                                </span></span>
<span><span class="co">#&gt; 156:      156 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt; 157:      157 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt; 158:      158 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt; 159:      159 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="co">#&gt; 160:      160 &lt;data.table[1x14]&gt; &lt;data.table[159x6]&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scenario_sims</span><span class="op">$</span><span class="va">data</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;    r0_community r0_isolated disp_community disp_isolated prop_presymptomatic</span></span>
<span><span class="co">#&gt;           &lt;num&gt;       &lt;num&gt;          &lt;num&gt;         &lt;num&gt;               &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          1.1           0           0.16             1                0.01</span></span>
<span><span class="co">#&gt;    prop_asymptomatic prop_ascertain initial_cases quarantine cap_max_days</span></span>
<span><span class="co">#&gt;                &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;lgcl&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                 0              0             5      FALSE          365</span></span>
<span><span class="co">#&gt;    cap_cases  delay onset_to_isolation incubation_period</span></span>
<span><span class="co">#&gt;        &lt;num&gt; &lt;char&gt;             &lt;list&gt;            &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:      5000   SARS      &lt;function[1]&gt;     &lt;function[1]&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;    r0_community r0_isolated disp_community disp_isolated prop_presymptomatic</span></span>
<span><span class="co">#&gt;           &lt;num&gt;       &lt;num&gt;          &lt;num&gt;         &lt;num&gt;               &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          1.1           0           0.16             1                0.01</span></span>
<span><span class="co">#&gt;    prop_asymptomatic prop_ascertain initial_cases quarantine cap_max_days</span></span>
<span><span class="co">#&gt;                &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;lgcl&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                 0              0             5      FALSE          365</span></span>
<span><span class="co">#&gt;    cap_cases  delay onset_to_isolation incubation_period</span></span>
<span><span class="co">#&gt;        &lt;num&gt; &lt;char&gt;             &lt;list&gt;            &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:      5000  Wuhan      &lt;function[1]&gt;     &lt;function[1]&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;    r0_community r0_isolated disp_community disp_isolated prop_presymptomatic</span></span>
<span><span class="co">#&gt;           &lt;num&gt;       &lt;num&gt;          &lt;num&gt;         &lt;num&gt;               &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:          1.5           0           0.16             1                0.01</span></span>
<span><span class="co">#&gt;    prop_asymptomatic prop_ascertain initial_cases quarantine cap_max_days</span></span>
<span><span class="co">#&gt;                &lt;num&gt;          &lt;num&gt;         &lt;num&gt;     &lt;lgcl&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                 0              0             5      FALSE          365</span></span>
<span><span class="co">#&gt;    cap_cases  delay onset_to_isolation incubation_period</span></span>
<span><span class="co">#&gt;        &lt;num&gt; &lt;char&gt;             &lt;list&gt;            &lt;list&gt;</span></span>
<span><span class="co">#&gt; 1:      5000   SARS      &lt;function[1]&gt;     &lt;function[1]&gt;</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scenario_sims</span><span class="op">$</span><span class="va">sims</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0         cases_per_gen</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;                &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0            7          7     0.300000                   3,0</span></span>
<span><span class="co">#&gt;   2:     1     1            1          8     0.300000                   3,0</span></span>
<span><span class="co">#&gt;   3:     1     2            0          8     0.300000                   3,0</span></span>
<span><span class="co">#&gt;   4:     1     3            0          8     0.300000                   3,0</span></span>
<span><span class="co">#&gt;   5:     1     4            0          8     0.300000                   3,0</span></span>
<span><span class="co">#&gt;  ---                                                                       </span></span>
<span><span class="co">#&gt; 155:     3    48            0        218     1.064619  8,10,14,14,44,32,...</span></span>
<span><span class="co">#&gt; 156:     3    49            0        218     1.064619  8,10,14,14,44,32,...</span></span>
<span><span class="co">#&gt; 157:     3    50            0        218     1.064619  8,10,14,14,44,32,...</span></span>
<span><span class="co">#&gt; 158:     3    51            0        218     1.064619  8,10,14,14,44,32,...</span></span>
<span><span class="co">#&gt; 159:     3    52            0        218     1.064619  8,10,14,14,44,32,...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0 cases_per_gen</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;        &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0            7          7          1.2         12, 0</span></span>
<span><span class="co">#&gt;   2:     1     1            9         16          1.2         12, 0</span></span>
<span><span class="co">#&gt;   3:     1     2            1         17          1.2         12, 0</span></span>
<span><span class="co">#&gt;   4:     1     3            0         17          1.2         12, 0</span></span>
<span><span class="co">#&gt;   5:     1     4            0         17          1.2         12, 0</span></span>
<span><span class="co">#&gt;  ---                                                               </span></span>
<span><span class="co">#&gt; 155:     3    48            0         13          0.8           8,0</span></span>
<span><span class="co">#&gt; 156:     3    49            0         13          0.8           8,0</span></span>
<span><span class="co">#&gt; 157:     3    50            0         13          0.8           8,0</span></span>
<span><span class="co">#&gt; 158:     3    51            0         13          0.8           8,0</span></span>
<span><span class="co">#&gt; 159:     3    52            0         13          0.8           8,0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;        sim  week weekly_cases cumulative effective_r0</span></span>
<span><span class="co">#&gt;      &lt;int&gt; &lt;num&gt;        &lt;num&gt;      &lt;num&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:     1     0            5          5     0.100000</span></span>
<span><span class="co">#&gt;   2:     1     1            1          6     0.100000</span></span>
<span><span class="co">#&gt;   3:     1     2            0          6     0.100000</span></span>
<span><span class="co">#&gt;   4:     1     3            0          6     0.100000</span></span>
<span><span class="co">#&gt;   5:     1     4            0          6     0.100000</span></span>
<span><span class="co">#&gt;  ---                                                 </span></span>
<span><span class="co">#&gt; 155:     3    48            0       5083     1.629195</span></span>
<span><span class="co">#&gt; 156:     3    49            0       5083     1.629195</span></span>
<span><span class="co">#&gt; 157:     3    50            0       5083     1.629195</span></span>
<span><span class="co">#&gt; 158:     3    51            0       5083     1.629195</span></span>
<span><span class="co">#&gt; 159:     3    52            0       5083     1.629195</span></span>
<span><span class="co">#&gt;                    cases_per_gen</span></span>
<span><span class="co">#&gt;                           &lt;list&gt;</span></span>
<span><span class="co">#&gt;   1:                         1,0</span></span>
<span><span class="co">#&gt;   2:                         1,0</span></span>
<span><span class="co">#&gt;   3:                         1,0</span></span>
<span><span class="co">#&gt;   4:                         1,0</span></span>
<span><span class="co">#&gt;   5:                         1,0</span></span>
<span><span class="co">#&gt;  ---                            </span></span>
<span><span class="co">#&gt; 155:  36, 33, 43, 43,102,115,...</span></span>
<span><span class="co">#&gt; 156:  36, 33, 43, 43,102,115,...</span></span>
<span><span class="co">#&gt; 157:  36, 33, 43, 43,102,115,...</span></span>
<span><span class="co">#&gt; 158:  36, 33, 43, 43,102,115,...</span></span>
<span><span class="co">#&gt; 159:  36, 33, 43, 43,102,115,...</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-scenarios-in-parallel">Running scenarios in parallel<a class="anchor" aria-label="anchor" href="#running-scenarios-in-parallel"></a>
</h2>
<p>Finally, we demonstrate how the above example can be easily run in
parallel using the <a href="https://www.futureverse.org/" class="external-link">{future}
framework</a>. We load the {future} and {future.apply} R packages for
this.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span></span></code></pre></div>
<p>We can replace the <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> with the
<code><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future.apply::future_lapply()</a></code> function and then choose how
to run the analysis in parallel. See <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">?future::plan</a></code> for
details.</p>
<p>Here we show how to run the analysis on 2 separate R sessions running
in the background.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"multisession"</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Now we re-run the parameter sweep with parallelisation.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scenario_sims</span><span class="op">[</span>, <span class="va">sims</span> <span class="op">:=</span> <span class="fu"><a href="https://future.apply.futureverse.org/reference/future_lapply.html" class="external-link">future_lapply</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">x</span>, <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/scenario_sim.html">scenario_sim</a></span><span class="op">(</span></span>
<span>    n <span class="op">=</span> <span class="va">n</span>,</span>
<span>    initial_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">initial_cases</span>,</span>
<span>    offspring <span class="op">=</span> <span class="fu"><a href="../reference/offspring_opts.html">offspring_opts</a></span><span class="op">(</span></span>
<span>      community <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_community</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_community</span><span class="op">)</span>,</span>
<span>      isolated <span class="op">=</span> \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/NegBinomial.html" class="external-link">rnbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, mu <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">r0_isolated</span>, size <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">disp_isolated</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    delays <span class="op">=</span> <span class="fu"><a href="../reference/delay_opts.html">delay_opts</a></span><span class="op">(</span></span>
<span>      incubation_period <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">incubation_period</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>      onset_to_isolation <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">onset_to_isolation</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    event_probs <span class="op">=</span> <span class="fu"><a href="../reference/event_prob_opts.html">event_prob_opts</a></span><span class="op">(</span></span>
<span>      asymptomatic <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_asymptomatic</span>,</span>
<span>      presymptomatic_transmission <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_presymptomatic</span>,</span>
<span>      symptomatic_ascertained <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">prop_ascertain</span></span>
<span>    <span class="op">)</span>,</span>
<span>    interventions <span class="op">=</span> <span class="fu"><a href="../reference/intervention_opts.html">intervention_opts</a></span><span class="op">(</span>quarantine <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">quarantine</span><span class="op">)</span>,</span>
<span>    sim <span class="op">=</span> <span class="fu"><a href="../reference/sim_opts.html">sim_opts</a></span><span class="op">(</span>cap_max_days <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_max_days</span>, cap_cases <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">cap_cases</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  n <span class="op">=</span> <span class="va">n</span>,</span>
<span>  future.seed <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scenario_sims</span></span></code></pre></div>
<p>Note, we set the <code>future.seed = TRUE</code> to ensure that
parallel-safe random numbers are produced.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joel Hellewell, Sam Abbott, Amy Gimma, Tim Lucas, Sebastian Funk, Adam Kucharski, Joshua W. Lambert.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
